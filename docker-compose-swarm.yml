version:  '3'

services: 
  nginx:
    container_name: nginx
    #build: ./nginx
    image: concretecristiantrucco/desafio_nginx:1.0
    networks:
       -  desafio-passei-direto
    ports:  
    - 80:80
    depends_on:
        - application
    links:  
     - application
    restart: always

  mysql:
    image: concretecristiantrucco/desafio_mysql:1.0
    #build: ./mysql
    container_name: mysql
    #command: mysql -u root -p root -h localhost notes database_schema.sql /dev/null
    command: mysqld --user=root
    volumes:
      - db_data:/var/lib/mysq
      - ./mysql-dump:/docker-entrypoint-initdb.d
    environment:
      - MYSQL_DATABASE=notes
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_ROOT_USER=root
      - MYSQL_USER=notes-api
      - MYSQL_PASSWORD=notes-api
    
    networks:
       -  desafio-passei-direto
    ports:
      - 3306:3306
    restart: on-failure

  application:
    #build: ./application
    image: concretecristiantrucco/application:1.0
    container_name: application

    ports:
      - 8080:8080
    networks:
       -  desafio-passei-direto  
    restart: on-failure
    depends_on:
        - mysql
volumes:
    db_data:

networks:
  desafio-passei-direto:
